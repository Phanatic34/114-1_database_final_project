# 校園生活用品交換與買賣平台 - 完整啟動指南

Group 22 - Database Final Project (114-1)

## 🚀 快速啟動

### 方式一：使用啟動腳本（推薦）

**雙擊執行：`啟動所有服務.bat`**

腳本會自動：
1. 檢查 Python 環境
2. 啟動後端服務（Flask）
3. 啟動前端服務（HTTP Server）
4. 開啟兩個視窗分別運行服務

**停止服務：** 雙擊執行 `停止所有服務.bat`

### 方式二：手動啟動（三步驟）

#### 步驟 1：啟動後端服務

**開啟終端視窗 1：**

```bash
cd .backend
python app.py
```

**成功訊息：**
```
 * Running on http://127.0.0.1:5000
 * Debug mode: on
```

**重要：** 保持這個視窗開啟，不要關閉！

#### 步驟 2：啟動前端服務

**開啟終端視窗 2：**

```bash
cd .frontend
python server.py
```

**成功訊息：**
```
========================================
  前端服務已啟動
========================================

  網址: http://localhost:8000
  狀態: 已禁用快取（避免 304 問題）
```

**注意：** 新的伺服器會自動禁用快取，避免瀏覽器返回 304 狀態碼，確保總是載入最新版本的文件。

#### 步驟 3：開啟網站

在瀏覽器開啟：
```
http://localhost:8000
```

## 📋 前置需求檢查

### 1. 資料庫服務

#### PostgreSQL
- ✅ 確認服務運行中（Windows 服務管理員）
- ✅ 資料庫已建立：`campus_trading`
- ✅ 資料庫已初始化（執行過 `python database/init_db.py`）

#### MongoDB Atlas
- ✅ 已設定連接字串在 `.backend/.env` 中
- ✅ 已初始化 Collections（執行過 `python database/mongodb_schema.py`）

### 2. 環境變數設定

確認 `.backend/.env` 檔案存在且正確設定：

```env
# PostgreSQL 資料庫配置
DB_HOST=localhost
DB_PORT=5432
DB_NAME=campus_trading
DB_USER=postgres
DB_PASSWORD=josh0702

# MongoDB 配置
MONGO_URI=mongodb+srv://fanjosh:josh0702@cluster0.780gv9p.mongodb.net/campus_trading_nosql?retryWrites=true&w=majority

# Flask 配置
FLASK_ENV=development
PORT=5000
```

### 3. Python 依賴

如果還沒安裝，執行：
```bash
cd .backend
pip install -r requirements.txt
```

## 🔧 第一次設定（如果還沒完成）

### 1. 初始化資料庫

```bash
cd .backend

# 初始化 PostgreSQL
python database/init_db.py

# 初始化 MongoDB
python database/mongodb_schema.py
```

### 2. 測試後端 API

```bash
cd .backend
python test_api.py
```

應該會看到：
- ✅ 註冊成功
- ✅ 登入成功
- ✅ 商品添加成功
- ✅ 查詢成功

## 📁 專案結構

```
db-final/
├── .frontend/          # 前端檔案
│   ├── index.html      # 首頁
│   ├── login.html      # 登入頁
│   ├── register.html   # 註冊頁
│   ├── js/             # JavaScript 檔案
│   └── ...
├── .backend/           # 後端系統
│   ├── app.py          # 主程式（啟動後端）
│   ├── api/            # API 路由
│   ├── database/       # 資料庫腳本
│   └── ...
└── 啟動說明.md         # 本檔案
```

## 🌐 訪問地址

- **前端網站：** http://localhost:8000
- **後端 API：** http://localhost:5000
- **API 測試：** http://localhost:5000/api/products

## 🔧 清除快取（重要！）

如果登入後仍顯示未登入，或點擊右側選單會跳回登入頁，這是**瀏覽器快取**造成的。

### 快速解決方法

**方法 1：強制重新載入（推薦）**
- 按 **Ctrl + Shift + R**（Windows）或 **Cmd + Shift + R**（Mac）
- 這會強制重新載入所有資源，忽略快取

**方法 2：使用清除快取工具**
- 開啟 `http://localhost:8000/clear_cache.html`
- 點擊「檢查登入狀態」查看問題
- 點擊「清除登入快取」然後重新登入

**方法 3：開發者工具**
- 按 **F12** 開啟開發者工具
- 在 **Network** 標籤中，勾選「Disable cache」
- 保持開發者工具開啟，然後重新載入頁面

**方法 4：清除瀏覽資料**
- 按 **Ctrl + Shift + Delete**
- 選擇「快取的圖片和檔案」
- 時間範圍選擇「過去 1 小時」
- 點擊「清除資料」

詳細說明請參考：`.frontend/清除快取說明.md`

## ⚠️ 常見問題

### 問題 1：後端顯示 "Not Found"

**原因：** 這是正常的，因為後端只有 `/api/*` 路由

**解決：**
- 訪問 `http://localhost:5000/` 會顯示 API 資訊（已修正）
- 訪問 `http://localhost:5000/api` 會顯示 API 端點列表
- 實際 API 端點是 `http://localhost:5000/api/auth/login` 等

### 問題 2：前端無法登入

**錯誤：** "無法連接到伺服器" 或 "Failed to fetch"

**解決步驟：**
1. **檢查後端是否運行：**
   - 執行 `檢查服務狀態.bat` 或
   - 訪問 `http://localhost:5000/` 應該看到 JSON 回應

2. **檢查瀏覽器 Console（F12）：**
   - 查看 Network 標籤，確認 API 請求是否發出
   - 查看 Console 標籤，確認錯誤訊息

3. **確認 CORS 設定：**
   - 後端已啟用 CORS，允許所有來源
   - 如果仍有問題，檢查後端終端的錯誤訊息

4. **重新啟動服務：**
   - 執行 `停止所有服務.bat`
   - 再執行 `啟動所有服務.bat`

### 問題 3：後端無法啟動

**錯誤：** `ModuleNotFoundError: No module named 'flask'`

**解決：**
```bash
cd .backend
pip install -r requirements.txt
```

### 問題 4：資料庫連接失敗

**錯誤：** `password authentication failed`

**解決：**
1. 確認 PostgreSQL 服務運行中
2. 檢查 `.env` 檔案中的 `DB_PASSWORD` 是否正確
3. 確認資料庫 `campus_trading` 已建立

### 問題 5：端口被佔用

**錯誤：** `Address already in use`

**解決：**
1. 檢查是否有其他服務在使用相同端口
2. 或修改 `.env` 中的 `PORT=5001`（後端）或使用其他端口（前端）

### 問題 6：診斷工具

**使用診斷腳本：**
- 執行 `檢查服務狀態.bat` 來檢查所有服務狀態
- 執行 `.backend/test_backend.py` 來測試 API 端點

## 🎯 功能測試

### 測試後端 API

```bash
cd .backend
python test_api.py
```

### 測試前端功能

1. 開啟 http://localhost:8000
2. 註冊新帳號
3. 登入
4. 上架商品
5. 瀏覽商品
6. 提出交易請求

## 📝 重要提醒

1. **後端服務必須持續運行**，不要關閉運行 `python app.py` 的視窗
2. **前端服務也需要運行**，才能正常呼叫 API
3. **兩個服務需要同時運行**才能正常使用
4. 如果需要停止服務，在對應的終端中按 `Ctrl+C`

## 🔗 API 端點

### 認證
- `POST /api/auth/register` - 註冊
- `POST /api/auth/login` - 登入

### 商品
- `GET /api/products` - 查詢商品列表
- `GET /api/products/<id>` - 查詢單一商品
- `POST /api/products?user_id=<id>` - 新增商品
- `PUT /api/products/<id>?user_id=<id>` - 更新商品
- `DELETE /api/products/<id>?user_id=<id>` - 刪除商品

### 交易請求
- `POST /api/trade-requests?user_id=<id>` - 建立交易請求
- `GET /api/trade-requests?user_id=<id>&type=sent` - 查詢我提出的請求
- `GET /api/trade-requests?user_id=<id>&type=received` - 查詢我收到的請求

詳細 API 文檔請參考：`.backend/README.md`

## 💡 提示

- 使用瀏覽器開發者工具（F12）查看 Console 和 Network 標籤
- 後端日誌會顯示在運行 `python app.py` 的終端中
- 如果遇到問題，先檢查兩個服務是否都在運行

## 📞 需要幫助？

1. 確認兩個服務都在運行
2. 檢查瀏覽器 Console 的錯誤訊息
3. 檢查後端終端的錯誤訊息
4. 確認資料庫服務運行中

---

**專案成員：**
- B12705001 范嘉栩
- B12705021 周建凱
- B12705050 宋承陽

