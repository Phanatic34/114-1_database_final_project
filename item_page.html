<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>商品詳情 - 二手交易平台</title>
  <link rel="stylesheet" href="ItemDetailPage.css">
  <style>
    /* Additional styles for standalone HTML version */
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    }
    
    .standalone-note {
      background: #fff3cd;
      border: 1px solid #ffc107;
      padding: 1rem;
      margin: 1rem;
      border-radius: 8px;
      text-align: center;
    }

    /* Message button styling */
    .btn-message {
      padding: 0.875rem 1.5rem;
      border: 2px solid var(--primary-blue);
      border-radius: var(--border-radius);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      background: white;
      color: var(--primary-blue);
      width: 100%;
      margin-bottom: 0.5rem;
    }

    .btn-message:hover {
      background: var(--accent-blue);
    }

    /* Chat modal specific styles */
    .chat-header-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .chat-header-info .seller-avatar {
      width: 40px;
      height: 40px;
      font-size: 1.2rem;
    }

    .chat-header-info h2 {
      margin: 0;
      font-size: 1.2rem;
    }

    .chat-body {
      display: flex;
      flex-direction: column;
      height: 500px;
      padding: 0;
    }

    .messages-area {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
      background: #f9f9f9;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .message-bubble {
      max-width: 70%;
      padding: 0.75rem 1rem;
      border-radius: 12px;
      word-wrap: break-word;
    }

    .message-seller {
      align-self: flex-start;
      background: white;
      border: 1px solid var(--border-color);
    }

    .message-user {
      align-self: flex-end;
      background: var(--primary-blue);
      color: white;
    }

    .message-content {
      margin-bottom: 0.25rem;
      line-height: 1.4;
    }

    .message-time {
      font-size: 0.75rem;
      opacity: 0.7;
      margin-top: 0.25rem;
    }

    .chat-input-area {
      display: flex;
      gap: 0.5rem;
      padding: 1rem;
      border-top: 1px solid var(--border-color);
      background: white;
    }

    .chat-input-area input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      font-size: 0.95rem;
      font-family: inherit;
    }

    .chat-input-area input:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px var(--accent-blue);
    }

    .chat-input-area button {
      padding: 0.75rem 1.5rem;
      white-space: nowrap;
    }

    /* Shipping section styling */
    .shipping-section p {
      margin: 4px 0;
    }

    .shipping-section .pickup-type,
    .shipping-section .pickup-place,
    .shipping-section .pickup-time {
      font-weight: 500;
    }

    /* Inline seller info styling */
    .seller-inline-info {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 8px;
      margin-bottom: 16px;
      font-size: 14px;
      color: #555;
    }

    .seller-inline-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .seller-avatar-small {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #e0e7ff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #1d4ed8;
      flex-shrink: 0;
    }

    .seller-inline-text .seller-name-row {
      font-weight: 600;
      color: #111827;
    }

    .seller-inline-text .seller-rating-row {
      font-size: 13px;
      color: #6b7280;
    }

    .seller-inline-links {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .seller-link-button {
      border: none;
      background: transparent;
      padding: 0;
      font-size: 13px;
      color: #2563eb;
      cursor: pointer;
      text-decoration: underline;
    }

    .seller-link-button:hover {
      color: #1d4ed8;
    }

    @media (max-width: 768px) {
      .seller-inline-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="standalone-note">
    <strong>注意：</strong>這是獨立 HTML 版本，用於快速預覽。完整功能請使用 React 版本 (ItemDetailPage.tsx)
  </div>

  <!-- Header -->
  <header class="site-header">
    <div class="header-content">
      <div class="logo">二手交易平台</div>
      <nav class="header-nav">
        <a href="/">首頁</a>
        <a href="/categories">分類</a>
        <a href="/sell">賣東西</a>
      </nav>
      <div class="header-actions">
        <a href="/cart">購物車</a>
        <a href="/profile">我的帳號</a>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="breadcrumb">
      <a href="/">首頁</a> / <a href="/category/電玩遊戲">電玩遊戲</a> / <a href="/category/電玩遊戲/遊戲主機">遊戲主機</a>
    </div>

    <div class="item-layout">
      <!-- Left Column - Image Gallery -->
      <div class="item-column-left">
        <div class="image-gallery">
          <div class="main-image-container">
            <img
              id="main-image"
              src="https://via.placeholder.com/600x600/0064D2/FFFFFF?text=Nintendo+Switch+OLED"
              alt="Nintendo Switch OLED 白色主機"
              class="main-image"
            />
            <div class="image-badge">九成新</div>
          </div>
          <div class="thumbnail-strip">
            <button class="thumbnail active" onclick="changeImage(0)">
              <img src="https://via.placeholder.com/150/0064D2/FFFFFF?text=1" alt="View 1" />
            </button>
            <button class="thumbnail" onclick="changeImage(1)">
              <img src="https://via.placeholder.com/150/0052A3/FFFFFF?text=2" alt="View 2" />
            </button>
            <button class="thumbnail" onclick="changeImage(2)">
              <img src="https://via.placeholder.com/150/003D7A/FFFFFF?text=3" alt="View 3" />
            </button>
            <button class="thumbnail" onclick="changeImage(3)">
              <img src="https://via.placeholder.com/150/002855/FFFFFF?text=4" alt="View 4" />
            </button>
          </div>
        </div>

        <div class="item-attributes">
          <table class="attributes-table">
            <tbody>
              <tr>
                <td class="attr-label">商品狀況：</td>
                <td>九成新</td>
              </tr>
              <tr>
                <td class="attr-label">所在地：</td>
                <td>台北市信義區</td>
              </tr>
              <tr>
                <td class="attr-label">庫存數量：</td>
                <td>1 件</td>
              </tr>
              <tr>
                <td class="attr-label">標籤：</td>
                <td>
                  <div class="tags">
                    <span class="tag">Nintendo</span>
                    <span class="tag">Switch</span>
                    <span class="tag">OLED</span>
                    <span class="tag">遊戲主機</span>
                    <span class="tag">二手</span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Center Column - Product Info -->
      <div class="item-column-center">
        <h1 class="item-title">Nintendo Switch OLED 白色主機 九成新</h1>

        <div class="seller-inline-info">
          <div class="seller-inline-left">
            <div class="seller-avatar-small">
              <span>G</span>
            </div>
            <div class="seller-inline-text">
              <div class="seller-name-row">
                <span class="seller-name">game_lover_2024</span>
                <span class="seller-count">(127)</span>
              </div>
              <div class="seller-rating-row">
                <span class="seller-rating">99.9% 好評</span>
              </div>
            </div>
          </div>
          <div class="seller-inline-links">
            <button class="seller-link-button" type="button" onclick="window.location.href='/seller/game_lover_2024'">
              查看賣家其他商品
            </button>
            <button class="seller-link-button" type="button" id="sellerInlineMessageBtn">
              聯絡賣家
            </button>
          </div>
        </div>

        <div class="mode-badges">
          <span class="badge active">販售中</span>
          <span class="badge active">可交換（指定目標）</span>
          <span class="badge active">開放式許願</span>
        </div>

        <div class="trade-rules">
          <h2>交換規則</h2>
          <p><strong>想換：</strong>想換 PlayStation 5 或 Xbox Series X，也接受其他 Nintendo 主機相關商品</p>
          <p>也接受開放交換，買家可提出任何商品提案</p>
        </div>

        <div class="item-description">
          <h2>商品描述</h2>
          <div class="description-content">
            <p>Nintendo Switch OLED 白色主機，使用約一年，功能完全正常。</p>
            <p><strong>包含：</strong></p>
            <ul>
              <li>主機本體（白色）</li>
              <li>原廠底座</li>
              <li>原廠充電器</li>
              <li>原廠 Joy-Con（紅藍）</li>
              <li>原廠包裝盒</li>
            </ul>
            <p><strong>外觀狀況：</strong></p>
            <ul>
              <li>螢幕有保護貼，無刮痕</li>
              <li>機身有輕微使用痕跡</li>
              <li>所有按鍵功能正常</li>
              <li>Joy-Con 無飄移問題</li>
            </ul>
            <p>可面交或宅配，面交地點：台北市信義區</p>
          </div>
        </div>

        <div class="item-stats">
          <span>瀏覽次數：342</span>
          <span>追蹤人數：8</span>
        </div>
      </div>

      <!-- Right Column - Action Panel -->
      <div class="item-column-right">
        <div class="action-panel">
          <div class="price-section">
            <div class="price-main">NT$ 8,500</div>
            <div class="quantity-selector">
              <label>數量：</label>
              <select id="quantity-select" onchange="updateTotal()">
                <option value="1">1</option>
              </select>
            </div>
            <div class="total-price" id="total-price" style="display: none;">總計：NT$ 8,500</div>
          </div>

          <div class="action-buttons">
            <button class="btn-primary btn-full" onclick="handleAddToCart()">
              加入購物車
            </button>

            <button class="btn-primary btn-full" onclick="handlePurchase()">
              立即購買
            </button>

            <button class="btn-primary btn-full" onclick="handleTrade()">
              以物易物 (Trade)
            </button>

            <button id="messageButtonMain" class="btn-secondary btn-full" onclick="handleOpenChat()">
              Message
            </button>
          </div>

          <div class="shipping-section">
            <h4>取貨方式：</h4>
            <p>
              <span class="pickup-type">面交</span>
              <span class="pickup-separator"> | </span>
              <span class="pickup-place">台北市信義區</span>
              <span class="pickup-separator"> | </span>
              <span class="pickup-time">時間可議</span>
            </p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Trade Modal -->
  <div id="trade-modal" class="modal-overlay" style="display: none;" onclick="closeTradeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2>提出交換提案</h2>
        <button class="modal-close" onclick="closeTradeModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="trade-requirement">
          <strong>賣家需求：</strong>
          <p>想換 PlayStation 5 或 Xbox Series X，也接受其他 Nintendo 主機相關商品</p>
        </div>
        <div class="user-items-list">
          <h3>選擇你的物品（僅可選擇一項）：</h3>
          <div class="items-grid">
            <div class="trade-item-card item-card" data-item-id="ps5" onclick="selectTradeItem(this)">
              <img src="https://via.placeholder.com/150/0064D2/FFFFFF?text=PS5" alt="PlayStation 5" />
              <div class="item-card-title">PlayStation 5 光碟版</div>
            </div>
            <div class="trade-item-card item-card" data-item-id="xbox-series-x" onclick="selectTradeItem(this)">
              <img src="https://via.placeholder.com/150/0052A3/FFFFFF?text=Xbox" alt="Xbox Series X" />
              <div class="item-card-title">Xbox Series X</div>
            </div>
          </div>
        </div>
        <div class="trade-message">
          <label for="trade-message">給賣家的訊息（選填）：</label>
          <textarea id="trade-message" placeholder="例如：希望可以當面交換，時間地點可議..." rows="4"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeTradeModal()">取消</button>
        <button id="submitTradeBtn" class="btn-primary" onclick="handleSubmitTrade()" disabled>送出交換提案</button>
      </div>
    </div>
  </div>

  <!-- Chat Modal -->
  <div id="chat-modal" class="modal-overlay" style="display: none;" onclick="closeChatModal()">
    <div class="modal-content chat-modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div class="chat-header-info">
          <div class="seller-avatar">G</div>
          <h2>game_lover_2024</h2>
        </div>
        <button class="modal-close" onclick="closeChatModal()">×</button>
      </div>
      <div class="modal-body chat-body">
        <div class="messages-area" id="messages-area">
          <div class="message-bubble message-seller">
            <div class="message-content">你好！對這個商品有興趣嗎？</div>
            <div class="message-time">昨天 14:30</div>
          </div>
          <div class="message-bubble message-user">
            <div class="message-content">你好，我想了解一下商品狀況</div>
            <div class="message-time">昨天 15:20</div>
          </div>
        </div>
        <div class="chat-input-area">
          <input type="text" id="chat-message" placeholder="輸入訊息..." />
          <button class="btn-primary" onclick="handleSendMessage()">Send</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Image gallery
    const images = [
      'https://via.placeholder.com/600x600/0064D2/FFFFFF?text=Nintendo+Switch+1',
      'https://via.placeholder.com/600x600/0052A3/FFFFFF?text=Nintendo+Switch+2',
      'https://via.placeholder.com/600x600/003D7A/FFFFFF?text=Nintendo+Switch+3',
      'https://via.placeholder.com/600x600/002855/FFFFFF?text=Nintendo+Switch+4',
    ];

    function changeImage(index) {
      document.getElementById('main-image').src = images[index];
      document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
        thumb.classList.toggle('active', i === index);
      });
    }

    // Quantity and total
    function updateTotal() {
      const quantity = parseInt(document.getElementById('quantity-select').value);
      const price = 8500;
      const total = quantity * price;
      const totalEl = document.getElementById('total-price');
      if (quantity > 1) {
        totalEl.textContent = `總計：NT$ ${total.toLocaleString()}`;
        totalEl.style.display = 'block';
      } else {
        totalEl.style.display = 'none';
      }
    }

    // Actions
    function handleAddToCart() {
      const quantity = document.getElementById('quantity-select').value;
      alert(`已將 ${quantity} 件商品加入購物車`);
    }

    function handlePurchase() {
      const quantity = document.getElementById('quantity-select').value;
      const total = 8500 * parseInt(quantity);
      if (confirm(`確認購買\n\n商品：Nintendo Switch OLED\n數量：${quantity}\n總計：NT$ ${total.toLocaleString()}\n\n確定要購買嗎？`)) {
        alert('購買成功！將跳轉至付款頁面...');
      }
    }

    // Trade modal state - single selection only
    let selectedItemId = null;

    function handleTrade() {
      // Reset selection when opening modal
      selectedItemId = null;
      document.querySelectorAll('.trade-item-card').forEach(card => {
        card.classList.remove('selected');
      });
      updateSubmitButtonState();
      document.getElementById('trade-modal').style.display = 'flex';
    }

    function closeTradeModal() {
      document.getElementById('trade-modal').style.display = 'none';
      // Reset selection when closing
      selectedItemId = null;
      document.querySelectorAll('.trade-item-card').forEach(card => {
        card.classList.remove('selected');
      });
    }

    function selectTradeItem(card) {
      const itemId = card.dataset.itemId;
      
      // If clicking the same selected card, toggle it off
      if (selectedItemId === itemId) {
        card.classList.remove('selected');
        selectedItemId = null;
      } else {
        // Clear all selections
        document.querySelectorAll('.trade-item-card').forEach(c => {
          c.classList.remove('selected');
        });
        // Select only this card
        card.classList.add('selected');
        selectedItemId = itemId;
      }
      
      updateSubmitButtonState();
    }

    function updateSubmitButtonState() {
      const submitBtn = document.getElementById('submitTradeBtn');
      if (selectedItemId) {
        submitBtn.disabled = false;
        submitBtn.classList.remove('disabled');
      } else {
        submitBtn.disabled = true;
        submitBtn.classList.add('disabled');
      }
    }

    function handleSubmitTrade() {
      if (!selectedItemId) {
        return;
      }

      const messageTextarea = document.getElementById('trade-message');
      const message = messageTextarea ? messageTextarea.value.trim() : '';

      const payload = {
        offeredItemId: selectedItemId,
        message: message,
      };

      console.log('Submitting 1-to-1 trade offer', payload);
      
      alert('交換提案已送出！賣家將收到通知。');
      closeTradeModal();
    }

    function handleOpenChat() {
      document.getElementById('chat-modal').style.display = 'flex';
      // Focus on input when modal opens
      setTimeout(() => {
        document.getElementById('chat-message').focus();
      }, 100);
    }

    function closeChatModal() {
      document.getElementById('chat-modal').style.display = 'none';
      document.getElementById('chat-message').value = '';
    }

    function handleSendMessage(event) {
      if (event) {
        event.preventDefault();
      }
      const input = document.getElementById('chat-message');
      const message = input.value.trim();
      
      if (!message) {
        return;
      }

      // Create new message bubble
      const messagesArea = document.getElementById('messages-area');
      const messageBubble = document.createElement('div');
      messageBubble.className = 'message-bubble message-user';
      
      const messageContent = document.createElement('div');
      messageContent.className = 'message-content';
      messageContent.textContent = message;
      
      const messageTime = document.createElement('div');
      messageTime.className = 'message-time';
      const now = new Date();
      messageTime.textContent = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
      
      messageBubble.appendChild(messageContent);
      messageBubble.appendChild(messageTime);
      messagesArea.appendChild(messageBubble);
      
      // Scroll to bottom
      messagesArea.scrollTop = messagesArea.scrollHeight;
      
      // Clear input
      input.value = '';
      
      // Log to console
      console.log('Message sent:', message);
    }

    // Allow Enter key to send message
    // Since script is at bottom of body, DOM is already loaded
    (function() {
      const chatInput = document.getElementById('chat-message');
      if (chatInput) {
        chatInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            handleSendMessage(e);
          }
        });
      }
    })();

    // Hook up inline seller message button to chat modal
    (function() {
      const inlineMsgBtn = document.getElementById('sellerInlineMessageBtn');
      if (inlineMsgBtn) {
        inlineMsgBtn.addEventListener('click', handleOpenChat);
      }
    })();
  </script>
</body>
</html>

