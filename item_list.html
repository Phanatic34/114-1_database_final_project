<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>瀏覽商品 - 二手交易平台</title>
  <link rel="stylesheet" href="ItemDetailPage.css">
  <style>
    /* Additional styles for item list page */
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background-color: #f5f5f5;
    }

    .standalone-note {
      background: #fff3cd;
      border: 1px solid #ffc107;
      padding: 1rem;
      margin: 1rem;
      border-radius: 8px;
      text-align: center;
    }

    /* Item List Page Layout */
    .item-list-page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    .item-list-layout {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    /* Search Bar */
    .item-search-bar {
      background: #ffffff;
      border-radius: 16px;
      padding: 20px 24px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 24px;
    }

    .item-list-title {
      font-size: 24px;
      font-weight: 700;
      margin: 0;
      color: #111827;
    }

    .item-search-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      flex: 1;
      max-width: 600px;
    }

    .item-search-controls select {
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      background: white;
      cursor: pointer;
    }

    .item-search-controls input[type="text"] {
      flex: 1;
      padding: 10px 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
    }

    .item-search-controls input[type="text"]:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    /* Filter Tabs */
    .item-filter-tabs {
      display: flex;
      gap: 8px;
      padding: 12px 0;
      margin-bottom: 16px;
      border-bottom: 1px solid #e5e7eb;
      overflow-x: auto;
    }

    .filter-tab {
      padding: 8px 16px;
      border: none;
      background: transparent;
      color: #6b7280;
      font-size: 14px;
      cursor: pointer;
      border-radius: 8px;
      white-space: nowrap;
      transition: all 0.2s;
    }

    .filter-tab:hover {
      background: #f3f4f6;
      color: #111827;
    }

    .filter-tab.active {
      color: #2563eb;
      font-weight: 600;
      background: #eff6ff;
      border-bottom: 2px solid #2563eb;
    }

    /* Main Content Layout */
    .item-list-main {
      display: grid;
      grid-template-columns: 260px minmax(0, 1fr);
      gap: 24px;
      margin-top: 16px;
    }

    /* Sidebar */
    .item-list-sidebar {
      background: #ffffff;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .sidebar-section {
      margin-bottom: 24px;
    }

    .sidebar-section:last-child {
      margin-bottom: 0;
    }

    .sidebar-section h3 {
      font-size: 15px;
      font-weight: 600;
      margin: 0 0 12px 0;
      color: #111827;
    }

    .sidebar-section ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar-section li {
      margin-bottom: 8px;
    }

    .sidebar-section label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #374151;
      cursor: pointer;
    }

    .sidebar-section input[type="radio"],
    .sidebar-section input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
    }

    /* Results Section */
    .item-list-results {
      display: flex;
      flex-direction: column;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 14px;
      color: #6b7280;
    }

    .results-sort {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .results-sort label {
      font-size: 14px;
      color: #6b7280;
    }

    .results-sort select {
      padding: 6px 12px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      background: white;
      cursor: pointer;
    }

    /* Item Card Grid */
    .item-card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 16px;
    }

    .item-card {
      display: flex;
      flex-direction: column;
      border-radius: 16px;
      background: #ffffff;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.06);
      text-decoration: none;
      color: inherit;
      overflow: hidden;
      transition: all 0.2s;
    }

    .item-card:hover {
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.1);
      transform: translateY(-2px);
    }

    .item-card-image-wrapper {
      position: relative;
      background: #f3f4f6;
      width: 100%;
    }

    .item-card-image {
      width: 100%;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      display: block;
    }

    .item-card-badge {
      position: absolute;
      top: 8px;
      left: 8px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #2563eb;
      color: #ffffff;
      font-size: 12px;
      font-weight: 600;
    }

    .item-card-body {
      padding: 10px 12px 12px;
    }

    .item-card-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      color: #111827;
    }

    .item-card-price {
      font-size: 15px;
      font-weight: 700;
      color: #2563eb;
      margin-bottom: 4px;
    }

    .item-card-modes {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 4px;
    }

    .mode-pill {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      font-weight: 500;
    }

    .mode-purchase {
      background: #dbeafe;
      color: #1d4ed8;
    }

    .mode-trade {
      background: #ecfdf3;
      color: #15803d;
    }

    .mode-wish {
      background: #fef3c7;
      color: #92400e;
    }

    .item-card-meta {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #6b7280;
      margin-top: 4px;
    }

    /* Pagination */
    .results-pagination {
      display: flex;
      justify-content: center;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid #e5e7eb;
    }

    /* Buttons */
    .btn-primary {
      padding: 10px 20px;
      border-radius: 999px;
      border: none;
      background: #2563eb;
      color: #ffffff;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn-outline {
      padding: 10px 20px;
      border-radius: 999px;
      border: 1px solid #2563eb;
      background: #ffffff;
      color: #2563eb;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .btn-outline:hover {
      background: #eff6ff;
    }

    /* Responsive */
    @media (max-width: 960px) {
      .item-list-main {
        grid-template-columns: 1fr;
      }

      .item-list-sidebar {
        position: static;
      }

      .item-search-bar {
        flex-direction: column;
        align-items: stretch;
      }

      .item-search-controls {
        max-width: 100%;
      }
    }

    @media (max-width: 640px) {
      .item-card-grid {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 12px;
      }

      .item-filter-tabs {
        gap: 4px;
      }

      .filter-tab {
        padding: 6px 12px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="standalone-note">
    <strong>注意：</strong>這是獨立 HTML 版本，用於快速預覽。完整功能請使用 React 版本
  </div>

  <!-- Header -->
  <header class="site-header">
    <div class="header-content">
      <div class="logo">二手交易平台</div>
      <nav class="header-nav">
        <a href="item_list.html">首頁</a>
        <a href="/categories">分類</a>
        <a href="/sell">賣東西</a>
      </nav>
      <div class="header-actions">
        <a href="/cart">購物車</a>
        <a href="/profile">我的帳號</a>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="breadcrumb">
      <a href="item_list.html">首頁</a> / <a href="item_list.html">瀏覽商品</a>
    </div>

    <div class="item-list-page">
      <div class="item-list-layout">
        <!-- Search Bar -->
        <section class="item-search-bar">
          <h1 class="item-list-title">瀏覽商品</h1>
          <div class="item-search-controls">
            <select id="categoryFilter">
              <option value="all">所有分類</option>
              <option value="games">遊戲主機 / 遊戲</option>
              <option value="electronics">3C / 電子產品</option>
              <option value="books">書籍 / 課本</option>
              <option value="others">其他</option>
            </select>
            <input
              id="searchInput"
              type="text"
              placeholder="搜尋商品名稱或關鍵字..."
            />
            <button id="searchButton" class="btn-primary">搜尋</button>
          </div>
        </section>

        <!-- Filter Tabs -->
        <nav class="item-filter-tabs">
          <button class="filter-tab active" data-filter="all">全部</button>
          <button class="filter-tab" data-filter="newest">最新上架</button>
          <button class="filter-tab" data-filter="price_asc">價格由低到高</button>
          <button class="filter-tab" data-filter="price_desc">價格由高到低</button>
          <button class="filter-tab" data-filter="purchase_only">只看可購買</button>
          <button class="filter-tab" data-filter="trade_only">只看可交換</button>
        </nav>

        <!-- Main Content -->
        <div class="item-list-main">
          <!-- Left Sidebar -->
          <aside class="item-list-sidebar">
            <section class="sidebar-section">
              <h3>類別</h3>
              <ul>
                <li><label><input type="radio" name="sidebarCategory" value="all" checked> 全部</label></li>
                <li><label><input type="radio" name="sidebarCategory" value="games"> 遊戲主機 / 遊戲</label></li>
                <li><label><input type="radio" name="sidebarCategory" value="electronics"> 3C / 電子產品</label></li>
                <li><label><input type="radio" name="sidebarCategory" value="books"> 書籍 / 課本</label></li>
                <li><label><input type="radio" name="sidebarCategory" value="others"> 其他</label></li>
              </ul>
            </section>

            <section class="sidebar-section">
              <h3>交易方式</h3>
              <ul>
                <li><label><input type="checkbox" id="filterPurchase"> 可購買</label></li>
                <li><label><input type="checkbox" id="filterTrade"> 可交換</label></li>
                <li><label><input type="checkbox" id="filterWish"> 開放式許願</label></li>
              </ul>
            </section>

            <section class="sidebar-section">
              <h3>商品狀況</h3>
              <ul>
                <li><label><input type="checkbox" value="new" class="condition-filter"> 全新</label></li>
                <li><label><input type="checkbox" value="like_new" class="condition-filter"> 九成新</label></li>
                <li><label><input type="checkbox" value="used" class="condition-filter"> 二手</label></li>
              </ul>
            </section>
          </aside>

          <!-- Right Results -->
          <section class="item-list-results">
            <div class="results-header">
              <span id="resultsCount">共 0 筆結果</span>
              <div class="results-sort">
                <label for="sortSelect">排序：</label>
                <select id="sortSelect">
                  <option value="default">預設</option>
                  <option value="newest">最新上架</option>
                  <option value="price_asc">價格由低到高</option>
                  <option value="price_desc">價格由高到低</option>
                </select>
              </div>
            </div>

            <div class="item-card-grid" id="itemCardGrid">
              <!-- Items will be rendered here by JavaScript -->
            </div>

            <div class="results-pagination">
              <button class="btn-outline" id="loadMoreButton">載入更多</button>
            </div>
          </section>
        </div>
      </div>
    </div>
  </main>

  <script src="data/itemsData.js"></script>
  <script>
    // State
    let currentItems = [...mockItems];
    let currentFilter = 'all';
    let currentSort = 'default';
    let displayedCount = 8;
    const itemsPerPage = 8;

    // Condition mapping for old data structure compatibility
    const conditionMap = {
      'new': '全新',
      'like_new': '九成新',
      'used': '二手'
    };

    // Create item card
    function createItemCard(item) {
      const a = document.createElement('a');
      a.href = `item_page.html?id=${encodeURIComponent(item.id)}`;
      a.className = 'item-card';
      a.setAttribute('data-id', item.id);

      const purchaseLabel = item.mode.purchase ? '可購買' : '';
      const tradeLabel = item.mode.trade ? '可交換' : '';
      const wishLabel = item.mode.wish ? '開放式許願' : '';

      let priceText = '';
      if (item.mode.purchase) {
        priceText = `NT$ ${item.price.toLocaleString('zh-TW')}`;
      } else if (item.mode.trade && !item.mode.purchase) {
        priceText = '僅接受以物易物';
      } else if (item.mode.wish && !item.mode.purchase) {
        priceText = '許願中';
      }

      a.innerHTML = `
        <div class="item-card-image-wrapper">
          <img src="${item.images[0]}" alt="${item.title}" class="item-card-image">
          <span class="item-card-badge">${item.condition}</span>
        </div>
        <div class="item-card-body">
          <h3 class="item-card-title">${item.title}</h3>
          <div class="item-card-price">${priceText}</div>
          <div class="item-card-modes">
            ${purchaseLabel ? `<span class="mode-pill mode-purchase">${purchaseLabel}</span>` : ''}
            ${tradeLabel ? `<span class="mode-pill mode-trade">${tradeLabel}</span>` : ''}
            ${wishLabel ? `<span class="mode-pill mode-wish">${wishLabel}</span>` : ''}
          </div>
          <div class="item-card-meta">
            <span class="item-card-location">${item.location}</span>
            <span class="item-card-seller">${item.seller.name}</span>
          </div>
        </div>
      `;
      return a;
    }

    // Render items
    function renderList(items) {
      const grid = document.getElementById('itemCardGrid');
      grid.innerHTML = '';

      const itemsToShow = items.slice(0, displayedCount);

      itemsToShow.forEach(item => {
        grid.appendChild(createItemCard(item));
      });

      // Update result count
      document.getElementById('resultsCount').textContent = `共 ${items.length} 筆結果`;

      // Show/hide load more button
      const loadMoreBtn = document.getElementById('loadMoreButton');
      if (itemsToShow.length < items.length) {
        loadMoreBtn.style.display = 'block';
      } else {
        loadMoreBtn.style.display = 'none';
      }
    }

    // Filter and sort items
    function filterAndSortItems() {
      let filtered = [...mockItems];

      // Category filter (from dropdown or sidebar)
      const categoryFilter = document.getElementById('categoryFilter').value;
      const sidebarCategory = document.querySelector('input[name="sidebarCategory"]:checked')?.value;
      const activeCategory = sidebarCategory && sidebarCategory !== 'all' ? sidebarCategory : categoryFilter;

      if (activeCategory !== 'all') {
        filtered = filtered.filter(item => item.category === activeCategory);
      }

      // Search filter
      const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
      if (searchTerm) {
        filtered = filtered.filter(item => 
          item.title.toLowerCase().includes(searchTerm) ||
          item.seller.name.toLowerCase().includes(searchTerm)
        );
      }

      // Mode filters
      const filterPurchase = document.getElementById('filterPurchase').checked;
      const filterTrade = document.getElementById('filterTrade').checked;
      const filterWish = document.getElementById('filterWish').checked;

      if (filterPurchase || filterTrade || filterWish) {
        filtered = filtered.filter(item => {
          if (filterPurchase && !item.mode.purchase) return false;
          if (filterTrade && !item.mode.trade) return false;
          if (filterWish && !item.mode.wish) return false;
          return true;
        });
      }

      // Condition filters - map to new structure
      const conditionFilters = Array.from(document.querySelectorAll('.condition-filter:checked')).map(cb => {
        if (cb.value === 'new') return '全新';
        if (cb.value === 'like_new') return '九成新';
        if (cb.value === 'used') return '二手';
        return cb.value;
      });
      if (conditionFilters.length > 0) {
        filtered = filtered.filter(item => conditionFilters.includes(item.condition));
      }

      // Tab filters
      if (currentFilter === 'purchase_only') {
        filtered = filtered.filter(item => item.mode.purchase);
      } else if (currentFilter === 'trade_only') {
        filtered = filtered.filter(item => item.mode.trade);
      }

      // Sort
      if (currentSort === 'newest' || currentFilter === 'newest') {
        // Note: new data structure doesn't have createdAt, skip for now
        // filtered.sort((a, b) => b.createdAt - a.createdAt);
      } else if (currentSort === 'price_asc' || currentFilter === 'price_asc') {
        filtered.sort((a, b) => a.price - b.price);
      } else if (currentSort === 'price_desc' || currentFilter === 'price_desc') {
        filtered.sort((a, b) => b.price - a.price);
      }

      currentItems = filtered;
      displayedCount = itemsPerPage;
      renderList(currentItems);
      
      // Update URL params
      updateURLParams();
    }

    // Update URL parameters
    function updateURLParams() {
      const params = new URLSearchParams();
      const searchTerm = document.getElementById('searchInput').value.trim();
      const category = document.getElementById('categoryFilter').value;
      
      if (searchTerm) params.set('q', searchTerm);
      if (category !== 'all') params.set('cat', category);
      if (currentFilter !== 'all') params.set('filter', currentFilter);
      if (currentSort !== 'default') params.set('sort', currentSort);
      
      const newURL = window.location.pathname + (params.toString() ? '?' + params.toString() : '');
      window.history.replaceState({}, '', newURL);
    }

    // Read URL parameters on load
    function readURLParams() {
      const params = new URLSearchParams(window.location.search);
      
      const q = params.get('q');
      if (q) {
        document.getElementById('searchInput').value = q;
      }
      
      const cat = params.get('cat');
      if (cat) {
        document.getElementById('categoryFilter').value = cat;
        const sidebarRadio = document.querySelector(`input[name="sidebarCategory"][value="${cat}"]`);
        if (sidebarRadio) sidebarRadio.checked = true;
      }
      
      const filter = params.get('filter');
      if (filter) {
        currentFilter = filter;
        document.querySelectorAll('.filter-tab').forEach(tab => {
          if (tab.dataset.filter === filter) {
            tab.classList.add('active');
          } else {
            tab.classList.remove('active');
          }
        });
      }
      
      const sort = params.get('sort');
      if (sort) {
        currentSort = sort;
        document.getElementById('sortSelect').value = sort;
      }
    }

    // Event listeners
    document.getElementById('searchButton').addEventListener('click', filterAndSortItems);
    document.getElementById('searchInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        filterAndSortItems();
      }
    });

    document.getElementById('categoryFilter').addEventListener('change', filterAndSortItems);
    document.getElementById('sortSelect').addEventListener('change', (e) => {
      currentSort = e.target.value;
      filterAndSortItems();
    });

    // Sidebar filters
    document.querySelectorAll('input[name="sidebarCategory"]').forEach(radio => {
      radio.addEventListener('change', filterAndSortItems);
    });

    document.getElementById('filterPurchase').addEventListener('change', filterAndSortItems);
    document.getElementById('filterTrade').addEventListener('change', filterAndSortItems);
    document.getElementById('filterWish').addEventListener('change', filterAndSortItems);

    document.querySelectorAll('.condition-filter').forEach(checkbox => {
      checkbox.addEventListener('change', filterAndSortItems);
    });

    // Filter tabs
    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.addEventListener('click', (e) => {
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        e.target.classList.add('active');
        currentFilter = e.target.dataset.filter;
        filterAndSortItems();
      });
    });

    // Load more
    document.getElementById('loadMoreButton').addEventListener('click', () => {
      displayedCount += itemsPerPage;
      renderList(currentItems);
    });

    // Initial load: read URL params and render
    readURLParams();
    filterAndSortItems();
  </script>
</body>
</html>

